<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fichier 1 : Créer la base Cultivation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="CultData1_merging_files/libs/clipboard/clipboard.min.js"></script>
<script src="CultData1_merging_files/libs/quarto-html/quarto.js"></script>
<script src="CultData1_merging_files/libs/quarto-html/popper.min.js"></script>
<script src="CultData1_merging_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CultData1_merging_files/libs/quarto-html/anchor.min.js"></script>
<link href="CultData1_merging_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CultData1_merging_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CultData1_merging_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CultData1_merging_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CultData1_merging_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#importer-les-données" id="toc-importer-les-données" class="nav-link active" data-scroll-target="#importer-les-données">Importer les données</a>
  <ul class="collapse">
  <li><a href="#rassembler-par-région" id="toc-rassembler-par-région" class="nav-link" data-scroll-target="#rassembler-par-région">Rassembler par région</a></li>
  <li><a href="#verifs-avant-modifications" id="toc-verifs-avant-modifications" class="nav-link" data-scroll-target="#verifs-avant-modifications">Verifs avant modifications</a></li>
  </ul></li>
  <li><a href="#nettoyage-des-tables" id="toc-nettoyage-des-tables" class="nav-link" data-scroll-target="#nettoyage-des-tables">Nettoyage des tables</a>
  <ul class="collapse">
  <li><a href="#sélectionner-les-variables" id="toc-sélectionner-les-variables" class="nav-link" data-scroll-target="#sélectionner-les-variables">Sélectionner les variables</a></li>
  <li><a href="#harmoniser-les-variables" id="toc-harmoniser-les-variables" class="nav-link" data-scroll-target="#harmoniser-les-variables">Harmoniser les variables</a>
  <ul class="collapse">
  <li><a href="#noms-des-cultures" id="toc-noms-des-cultures" class="nav-link" data-scroll-target="#noms-des-cultures">Noms des cultures</a></li>
  <li><a href="#opérations" id="toc-opérations" class="nav-link" data-scroll-target="#opérations">Opérations</a></li>
  </ul></li>
  <li><a href="#gérer-les-doublons" id="toc-gérer-les-doublons" class="nav-link" data-scroll-target="#gérer-les-doublons">Gérer les doublons</a>
  <ul class="collapse">
  <li><a href="#cultinput" id="toc-cultinput" class="nav-link" data-scroll-target="#cultinput">CultInput</a></li>
  <li><a href="#plotlist" id="toc-plotlist" class="nav-link" data-scroll-target="#plotlist">PlotList</a></li>
  <li><a href="#cultoutput" id="toc-cultoutput" class="nav-link" data-scroll-target="#cultoutput">CultOutput</a></li>
  <li><a href="#landholding" id="toc-landholding" class="nav-link" data-scroll-target="#landholding">Landholding</a></li>
  </ul></li>
  <li><a href="#vérifier-les-doublons-restants" id="toc-vérifier-les-doublons-restants" class="nav-link" data-scroll-target="#vérifier-les-doublons-restants">Vérifier les doublons restants</a></li>
  </ul></li>
  <li><a href="#création-dune-clé-de-jonction" id="toc-création-dune-clé-de-jonction" class="nav-link" data-scroll-target="#création-dune-clé-de-jonction">Création d’une clé de jonction</a>
  <ul class="collapse">
  <li><a href="#correspondance-des-champs-entre-les-tables" id="toc-correspondance-des-champs-entre-les-tables" class="nav-link" data-scroll-target="#correspondance-des-champs-entre-les-tables">Correspondance des champs entre les tables</a></li>
  <li><a href="#base-validation_id" id="toc-base-validation_id" class="nav-link" data-scroll-target="#base-validation_id">Base validation_ID</a></li>
  <li><a href="#modifier-base-validation_id" id="toc-modifier-base-validation_id" class="nav-link" data-scroll-target="#modifier-base-validation_id">Modifier Base validation_ID</a></li>
  <li><a href="#identifier-les-champs-validés" id="toc-identifier-les-champs-validés" class="nav-link" data-scroll-target="#identifier-les-champs-validés">Identifier les champs validés</a></li>
  </ul></li>
  <li><a href="#création-dune-base-commune" id="toc-création-dune-base-commune" class="nav-link" data-scroll-target="#création-dune-base-commune">Création d’une base commune</a>
  <ul class="collapse">
  <li><a href="#joindre-en-colonne-les-bases" id="toc-joindre-en-colonne-les-bases" class="nav-link" data-scroll-target="#joindre-en-colonne-les-bases">Joindre en colonne les bases</a></li>
  <li><a href="#ajouter-la-caste" id="toc-ajouter-la-caste" class="nav-link" data-scroll-target="#ajouter-la-caste">Ajouter la caste</a></li>
  </ul></li>
  <li><a href="#liens-extérieurs" id="toc-liens-extérieurs" class="nav-link" data-scroll-target="#liens-extérieurs">Liens extérieurs</a>
  <ul class="collapse">
  <li><a href="#enregistrer-cultivation_wide_annee" id="toc-enregistrer-cultivation_wide_annee" class="nav-link" data-scroll-target="#enregistrer-cultivation_wide_annee">Enregistrer Cultivation_wide_annee</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fichier 1 : Créer la base Cultivation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="st">"params"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">graphics.off</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\014</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringdist)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<section id="importer-les-données" class="level1">
<h1>Importer les données</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"ICRISAT_database_analysis/scripts_all_years/CultData1_merging.qmd"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer l'année depuis les paramètres</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> params<span class="sc">$</span>annee</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Année :"</span>, annee, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Année : 2013 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>charger_fichier <span class="ot">&lt;-</span> <span class="cf">function</span>(zone, type, annee, <span class="at">suffix =</span> <span class="st">".xlsx"</span>) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  nom_fichier <span class="ot">&lt;-</span> <span class="fu">paste0</span>(zone, <span class="st">"_"</span>, type, <span class="st">"_"</span>, annee, suffix)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"raw_data"</span>, nom_fichier))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>EAST_CultInput      <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"EAST"</span>, <span class="st">"CultInput"</span>, annee)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>SAT_CultInput       <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"SAT"</span>, <span class="st">"CultInput"</span>, annee)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>EAST_CultOutput     <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"EAST"</span>, <span class="st">"CultOutput"</span>, annee)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>SAT_CultOutput      <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"SAT"</span>, <span class="st">"CultOutput"</span>, annee)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>EAST_PlotList       <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"EAST"</span>, <span class="st">"PlotList"</span>, annee)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>SAT_PlotList        <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"SAT"</span>, <span class="st">"PlotList"</span>, annee)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>EAST_Landholding    <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"EAST"</span>, <span class="st">"Landholding"</span>, annee)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>SAT_Landholding     <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"SAT"</span>, <span class="st">"Landholding"</span>, annee)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>EAST_Household_info <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"EAST"</span>, <span class="st">"Household"</span>, annee)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>SAT_Household_info  <span class="ot">&lt;-</span> <span class="fu">charger_fichier</span>(<span class="st">"SAT"</span>, <span class="st">"Household"</span>, annee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="rassembler-par-région" class="level2">
<h2 class="anchored" data-anchor-id="rassembler-par-région">Rassembler par région</h2>
<p>J’ajoute dans la base CultInput une variable pour identifier de quelle région proviennent les données.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>SAT_CultInput <span class="ot">&lt;-</span> SAT_CultInput <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"SAT"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>EAST_CultInput <span class="ot">&lt;-</span> EAST_CultInput <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"EAST"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PLOT_AREA désigne la superficie du plot et CROP_AREA celle du subplot (égale à celle du plot s’il n’y a pas de division du champ). De la même manière, PLOT_CODE désigne l’identifiant du plot et SUB_PLOT_CODE l’identifiant du subplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction pour renommer les variables</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rename_if_exists <span class="ot">&lt;-</span> <span class="cf">function</span>(df, old, new) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (old <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">rename</span>(df, <span class="sc">!!</span><span class="at">new :=</span> <span class="sc">!!</span><span class="fu">sym</span>(old))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>SAT_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultOutput, <span class="st">"PLOT_AREA"</span>, <span class="st">"CROP_AREA"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>SAT_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultOutput, <span class="st">"CROP_NAME"</span>, <span class="st">"CROP"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>SAT_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultOutput, <span class="st">"OP_REMARKS"</span>, <span class="st">"REMARKS"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>SAT_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultOutput, <span class="st">"PLOT_CO"</span>, <span class="st">"PLOT_CODE"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>EAST_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultOutput, <span class="st">"PLOT_AREA"</span>, <span class="st">"CROP_AREA"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>EAST_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultOutput, <span class="st">"CROP_NAME"</span>, <span class="st">"CROP"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>EAST_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultOutput, <span class="st">"OP_REMARKS"</span>, <span class="st">"REMARKS"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>EAST_CultOutput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultOutput, <span class="st">"PLOT_CO"</span>, <span class="st">"PLOT_CODE"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>SAT_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultInput, <span class="st">"PLOT_AREA"</span>, <span class="st">"CROP_AREA"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>SAT_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultInput, <span class="st">"PLOT_CO"</span>, <span class="st">"PLOT_CODE"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>SAT_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_CultInput, <span class="st">"IP_REMARKS"</span>, <span class="st">"REMARKS"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>EAST_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultInput, <span class="st">"PLOT_AREA"</span>, <span class="st">"CROP_AREA"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>EAST_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultInput, <span class="st">"PLOT_CO"</span>, <span class="st">"PLOT_CODE"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>EAST_CultInput <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_CultInput, <span class="st">"IP_REMARKS"</span>, <span class="st">"REMARKS"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(EAST_Landholding) <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">names</span>(EAST_Landholding))</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>EAST_Household_info <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(EAST_Household_info, <span class="st">"CASTE_CATEGORY"</span>, <span class="st">"CASTE_GROUP"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(EAST_Household_info) <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">names</span>(EAST_Household_info))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>EAST_Household_info <span class="ot">&lt;-</span> EAST_Household_info <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, CASTE, CASTE_GROUP)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>SAT_Household_info <span class="ot">&lt;-</span> <span class="fu">rename_if_exists</span>(SAT_Household_info, <span class="st">"CASTE_CATEGORY"</span>, <span class="st">"CASTE_GROUP"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SAT_Household_info) <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">names</span>(SAT_Household_info))</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>SAT_Household_info <span class="ot">&lt;-</span> SAT_Household_info <span class="sc">|&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, CASTE, CASTE_GROUP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Je repère si les colonnes ayant le même nom et vérifie si elles sont du même type (numeric ou character). Si ce n'est pas le cas, je les convertis en character, ce qui limite le nombre de NA. Il est nécessaire que les colonnes soient du même type pour utiliser la fonction bind_rows. </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>common_cols_cultinput <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(EAST_CultInput), <span class="fu">names</span>(SAT_CultInput))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> common_cols_cultinput) {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    EAST_CultInput[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(EAST_CultInput[[col]])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    SAT_CultInput[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(SAT_CultInput[[col]])</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>common_cols_cultoutput <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(EAST_CultOutput), <span class="fu">names</span>(SAT_CultOutput))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> common_cols_cultoutput) {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    EAST_CultOutput[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(EAST_CultOutput[[col]])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    SAT_CultOutput[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(SAT_CultOutput[[col]])</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>common_cols_plotlist <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(EAST_PlotList), <span class="fu">names</span>(SAT_PlotList))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> common_cols_plotlist) {</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    EAST_PlotList[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(EAST_PlotList[[col]])</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    SAT_PlotList[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(SAT_PlotList[[col]])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>common_cols_landholding <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(EAST_Landholding), <span class="fu">names</span>(SAT_Landholding))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> common_cols_landholding) {</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    EAST_Landholding[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(EAST_Landholding[[col]])</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    SAT_Landholding[[col]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(SAT_Landholding[[col]])</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>CultInput <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(EAST_CultInput, SAT_CultInput)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(EAST_CultOutput, SAT_CultOutput)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(EAST_PlotList, SAT_PlotList)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>Landholding <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(EAST_Landholding, SAT_Landholding)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Household_info <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(EAST_Household_info, SAT_Household_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="verifs-avant-modifications" class="level2">
<h2 class="anchored" data-anchor-id="verifs-avant-modifications">Verifs avant modifications</h2>
<p><em>N/a pour Lab_type et Work_hr</em></p>
<p>Je regarde combien de n/a ont les variables LAB_TYPE et WORK_HR.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>na_LAB_TYPE <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(LAB_TYPE)))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>na_WORK_HR <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(WORK_HR)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - N/a dans LAB_TYPE :"</span>, na_LAB_TYPE, <span class="st">"soit"</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> na_LAB_TYPE <span class="sc">/</span> <span class="fu">nrow</span>(CultInput), <span class="dv">1</span>), <span class="st">"% de la base CultInput </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - N/a dans LAB_TYPE : 8613 soit 8.6 % de la base CultInput </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - N/a dans WORK_HR :"</span>, na_WORK_HR, <span class="st">"soit"</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> na_WORK_HR <span class="sc">/</span> <span class="fu">nrow</span>(CultInput), <span class="dv">1</span>), <span class="st">"% de la base CultInput </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - N/a dans WORK_HR : 8709 soit 8.7 % de la base CultInput </code></pre>
</div>
</div>
<p>Les lignes pour lesquelles LAB_TYPE et WORK_HR ne sont pas complétées ajoutent une information sur la mécanisation (avec la variable TYPE_MAT) sur une opération spécifique. Il est donc pertinent de conserver ces lignes pour étudier la mécanisation (fertilizer, weedicide, seed, machinery).</p>
<p><em>Crop damage</em></p>
<p>Dans le questionnaire, si le champ est perdu, l’inspecteur doit indiquer un temps de travail nul pour la récolte et une production nulle (dans Cult_Output). Je regarde combien de champs ont un temps de travail pour Harvesting égal à 0 dans CultInput.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>crop_damage <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HARVEST =</span> <span class="fu">str_detect</span>(OPERATION, <span class="st">"Harves|HARVES"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HARVEST <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(WORK_HR <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(WORK_HR))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Nombre de potentiel crop damage :"</span>, <span class="fu">nrow</span>(crop_damage), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Nombre de potentiel crop damage : 29 </code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="nettoyage-des-tables" class="level1">
<h1>Nettoyage des tables</h1>
<section id="sélectionner-les-variables" class="level2">
<h2 class="anchored" data-anchor-id="sélectionner-les-variables">Sélectionner les variables</h2>
<p>Je pense que la variable PLOT_CODE complétée dans les bases CultInput et CultOutput représente l’identifiant du subplot (plutôt que du plot). C’est pourquoi, je renomme la variable SUB_PLOT_CODE pour ces 2 bases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>CultInput <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(REGION, VDS_ID, PLOT_NAME, PLOT_CODE, CROP_AREA, IRRI_AREA, SEASON, SUR_MON_YR, DT_OPER, OPERATION, LAB_TYPE, WORK_HR, WAGE, NAME_MAT, TYPE_MAT, QTY_MAT, UNIT_MAT, VAL_MAT, RATE_MAT, SOURCE_MAT) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LAB_TYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FM"</span>, <span class="st">"HM"</span>, <span class="st">"EM"</span>, <span class="st">"FF"</span>, <span class="st">"HF"</span>, <span class="st">"EF"</span>, <span class="st">"FC"</span>, <span class="st">"HC"</span>, <span class="st">"EC"</span>, <span class="st">"OB"</span>, <span class="st">"FC"</span>, <span class="st">"EB"</span>, <span class="st">"HB"</span>, <span class="st">"RS"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SUB_PLOT_CODE =</span> PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PLOT_CODE =</span> <span class="fu">substr</span>(SUB_PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">everything</span>(), toupper))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_NAME, PLOT_CODE, CROP_AREA, IRRI_AREA, SEASON, CROP, VAR_TYPE, VAR_NAME, PRCT_AREA, OP_MAIN_PROD_UNIT, OP_MAIN_PROD_QTY, OW_STAT, RENT_VAL, RENT_FOR) <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SUB_PLOT_CODE =</span> PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), toupper))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), toupper)) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_NAME, PLOT_CODE, SUB_PLOT_CODE, PLOT_AREA, CROP_AREA, IRRI_AREA, SEASON, CROP_1, CROP_2, CROP_3, CROP_4)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>Landholding <span class="ot">&lt;-</span> Landholding <span class="sc">|&gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PLOT_CODE =</span> <span class="fu">substr</span>(PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_CODE, SOIL_TYPE, SOIL_TYPE_OT, SOIL_DEPTH, SOIL_FERT, SLOPE, SOIL_DEGR)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>Household_info <span class="ot">&lt;-</span> Household_info <span class="sc">|&gt;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), toupper))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir et arrondir les superficies à la deuxième décimale</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>convertir_arrondir <span class="ot">&lt;-</span> <span class="cf">function</span>(df, cols) {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  df[cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df[cols], <span class="cf">function</span>(x) <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)), <span class="dv">2</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>CultInput  <span class="ot">&lt;-</span> <span class="fu">convertir_arrondir</span>(CultInput,  <span class="fu">c</span>(<span class="st">"CROP_AREA"</span>, <span class="st">"IRRI_AREA"</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> <span class="fu">convertir_arrondir</span>(CultOutput, <span class="fu">c</span>(<span class="st">"IRRI_AREA"</span>, <span class="st">"CROP_AREA"</span>))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>PlotList   <span class="ot">&lt;-</span> <span class="fu">convertir_arrondir</span>(PlotList,   <span class="fu">c</span>(<span class="st">"IRRI_AREA"</span>, <span class="st">"CROP_AREA"</span>, <span class="st">"PLOT_AREA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="harmoniser-les-variables" class="level2">
<h2 class="anchored" data-anchor-id="harmoniser-les-variables">Harmoniser les variables</h2>
<section id="noms-des-cultures" class="level3">
<h3 class="anchored" data-anchor-id="noms-des-cultures">Noms des cultures</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table de correspondance des cultures</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>correspondances_crop <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>CULTURE_VARIANT,      <span class="sc">~</span>CULTURE_STANDARD,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BAMBOO TREE"</span>,         <span class="st">"BAMBOO"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BLACK GRAM"</span>,          <span class="st">"BLACKGRAM"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN GRAM"</span>,          <span class="st">"BLACKGRAM"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREENGRAM"</span>,           <span class="st">"BLACKGRAM"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MAIZE FODDER"</span>,        <span class="st">"MAIZE"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHICK PEA"</span>,           <span class="st">"CHICKPEA"</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHIKPEA"</span>,             <span class="st">"CHICKPEA"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FELLOW"</span>,              <span class="st">"SEASONAL FALLOW"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FALLOW"</span>,              <span class="st">"SEASONAL FALLOW"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GROUND NUT"</span>,          <span class="st">"GROUNDNUT"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HORSE GRAM"</span>,          <span class="st">"HORSEGRAM"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TURMARIC"</span>,            <span class="st">"TURMURIC"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANGO TREE"</span>,          <span class="st">"MANGO"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANGOES"</span>,             <span class="st">"MANGO"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANGOES TREE"</span>,        <span class="st">"MANGO"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANGO ORCHARD"</span>,       <span class="st">"MANGO"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JUNGLE"</span>,              <span class="st">"JUNGLE TREE"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MUSTERD"</span>,             <span class="st">"MUSTARD"</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MUSTURD"</span>,             <span class="st">"MUSTARD"</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MASTURD"</span>,             <span class="st">"MUSTARD"</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PAADY"</span>,               <span class="st">"PADDY"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY  SEEDLING"</span>,     <span class="st">"PADDY"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY GODA"</span>,          <span class="st">"PADDY"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY NURSURY"</span>,       <span class="st">"PADDY"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY SEED"</span>,          <span class="st">"PADDY"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY SEEDLING"</span>,      <span class="st">"PADDY"</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY(SEEDLING)"</span>,     <span class="st">"PADDY"</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADDY LOCAL"</span>,         <span class="st">"PADDY"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PADY"</span>,                <span class="st">"PADDY"</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PIGEON PEA"</span>,          <span class="st">"PIGEONPEA"</span>,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PIGION PEA"</span>,          <span class="st">"PIGEONPEA"</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POTATAO"</span>,             <span class="st">"POTATO"</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SORGHUM FODDER"</span>,      <span class="st">"SORGHUM"</span>,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LIN SEED"</span>,            <span class="st">"LINSEED"</span>,</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FODDER (EGYPTIAN CLOVER)"</span>,<span class="st">"EGYPTIAN CLOVER"</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BERSEEM"</span>,             <span class="st">"EGYPTIAN CLOVER"</span>,</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OATS (JAI)"</span>,          <span class="st">"JAI"</span>,</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OTS"</span>,                 <span class="st">"JAI"</span>,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FODDER OATS (JAI)"</span>,   <span class="st">"JAI"</span>,</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN FODDER JAI"</span>,    <span class="st">"JAI"</span>,</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN FODDER (JANER)"</span>,<span class="st">"GREEN FODDER"</span>,</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SMALL MILLET (MARUA)"</span>,<span class="st">"MARUA"</span>,</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FRENCH BEANS"</span>,        <span class="st">"BEANS"</span>,</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FREANCH BEANS"</span>,       <span class="st">"BEANS"</span>,</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SMALL MILLET (SARGUJA)"</span>,<span class="st">"SARGUJA"</span>,</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHILLIES GREEN"</span>,      <span class="st">"CHILLIES"</span>,</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHILLI GREEN"</span>,        <span class="st">"CHILLIES"</span>,</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN CHILLY"</span>,        <span class="st">"CHILLIES"</span>,</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PEA"</span>,                 <span class="st">"PEAS"</span>,</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SESBANIA ACULEATA (DHAICHA)"</span>,<span class="st">"DHAICHA"</span>,</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LADYSFINGER"</span>,         <span class="st">"LADYS FINGER"</span>,</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEAFY VEGETABLE"</span>,     <span class="st">"LEAFY"</span>,</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VEGETABLE"</span>,           <span class="st">"LEAFY"</span>,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CORIENDER"</span>,           <span class="st">"CORIANDER"</span>,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RIDGEGOURD"</span>,          <span class="st">"RIDGE GOURD"</span>,</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WHEET"</span>,               <span class="st">"WHEAT"</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PlotList :</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer les cultures harmonisées à CROP_1</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correspondances_crop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CROP_1"</span> <span class="ot">=</span> <span class="st">"CULTURE_VARIANT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CROP_1 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(CULTURE_STANDARD), CULTURE_STANDARD, CROP_1)) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CULTURE_STANDARD) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer les cultures harmonisées à CROP_2</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correspondances_crop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CROP_2"</span> <span class="ot">=</span> <span class="st">"CULTURE_VARIANT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CROP_2 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(CULTURE_STANDARD), CULTURE_STANDARD, CROP_2)) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CULTURE_STANDARD)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># CultOuput : Appliquer les cultures harmonisées à CROP</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correspondances_crop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CROP"</span> <span class="ot">=</span> <span class="st">"CULTURE_VARIANT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CROP =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(CULTURE_STANDARD), CULTURE_STANDARD, CROP)) <span class="sc">|&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CULTURE_STANDARD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="opérations" class="level3">
<h3 class="anchored" data-anchor-id="opérations">Opérations</h3>
<p><em>1. Simplifier le nom des opérations</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des opérations principales</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>key_operations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># BUNDING</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BUND"</span>, <span class="st">"WATER CHANNEL"</span>,  <span class="st">"BASIN"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DIGGING</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIGGING"</span>, <span class="st">"LINING"</span>, <span class="st">"LINES"</span>, <span class="st">"FILLING"</span>, <span class="st">"TRENCHING"</span>, <span class="st">"PITTING"</span>, <span class="st">"LINE MAKING"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># UPROOTING</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UPROOTING"</span>, </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># LAND PREPARATION</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LAND PREPARATION"</span>, <span class="st">"FIELD PREPARATION"</span>, <span class="st">"PLOUGHING"</span>, <span class="st">"PUDDLING"</span>, <span class="st">"EARTHING UP"</span>, <span class="st">"BED PREPARATION"</span>, <span class="st">"BEEDING"</span>, <span class="st">"FURROW"</span>, <span class="st">"SOIL UP"</span>, <span class="st">"PANJI"</span>, <span class="st">"PUNJI"</span>, <span class="st">"BROAD CASTING"</span>, <span class="st">"ROTAVATOR"</span>, <span class="st">"PHANTAN"</span>, <span class="st">"V-PASS"</span>, <span class="st">"CANAL PREPARATION"</span>, <span class="st">"LEVELING"</span>, <span class="st">"LEVELLING"</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DIPPING</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIPPING"</span>, <span class="st">"DRENCHING"</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SOWING</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOWING"</span>, <span class="st">"SEED"</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HERBICIDE</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HERBICIDE"</span>, <span class="st">"WEEDICIDE"</span>, <span class="st">"HARBISIDE"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HAND WEEDIND</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HAND WEEDING"</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIELD CLEANING</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD CLEANING"</span>, <span class="st">"GRASS CLEANING"</span>, <span class="st">"SIDE CLEANING"</span>, <span class="st">"CLEANING AND WEEDING"</span>, <span class="st">"WEEDING AND CLEANING"</span>, <span class="st">"CLEANING WEED"</span>, </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HARVESTING/THRESHING</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARVEST"</span>, <span class="st">"THRESHING"</span>, <span class="st">"THRASHING"</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># WINNOWING</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WINNOWING"</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FENCE TRIMMING</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FENCE"</span>, <span class="st">"FENCING"</span>, </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MANURING</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MULCHING"</span>, <span class="st">"MANURING"</span>, </span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PINCHING/CUTTING</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PINCHING"</span>, <span class="st">"PRUNING"</span>, <span class="st">"CUTTING"</span>, <span class="st">"AIR LAYERING"</span>, <span class="st">"NIPPING"</span>,</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># INTERCULTURE</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INTERCULTURE"</span>, <span class="st">"HOEING"</span>, <span class="st">"PLUCKING"</span>, <span class="st">"THINNING"</span>, <span class="st">"BEDICIDE"</span>, <span class="st">"BINDING"</span>,</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRANSPLANTING</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPLANTING"</span>, <span class="st">"PLANTING"</span>, <span class="st">"PLANTATION"</span>,</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRANSPORT</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPORT"</span>, <span class="st">"LOADING"</span>, <span class="st">"STACKING"</span>, <span class="st">"PACKING"</span>, <span class="st">"CARRY"</span>,</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IRRIGATION</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IRRIGATION"</span>, <span class="st">"PIPELINE"</span>,</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SUPERVISION</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SUPERVISION"</span>, <span class="st">"WATCHING"</span>,</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GRADING/TAGGING</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GRADING"</span>, <span class="st">"TAGGING"</span>, </span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MARKETING</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MARKETING"</span>, <span class="st">"MAKING BY PRODUCT"</span>, <span class="st">"LABELING"</span>,</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GIRDLING</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GIRDLING"</span>, <span class="st">"GRIDLING"</span>,</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NURSERY RAISING</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NURSERY RAISING"</span>,</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRANSFORMATION</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSFORMATION"</span>, <span class="st">"PROCESSING"</span>, <span class="st">"REMOVING"</span>,</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OTHERS</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CURING"</span>, <span class="st">"COLLECTION"</span>,</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PLANT PROTECTION</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLANT PROTECTION"</span>, <span class="st">"BAGGING"</span>, <span class="st">"ASH"</span>, <span class="st">"FUMIGATION"</span>,</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PESTICIDE</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PESTICIDE"</span>, <span class="st">"SPRAY"</span>, <span class="st">"FUNGICIDE"</span>, <span class="st">"INSECTICIDE"</span>, <span class="st">"DEFOLIATION"</span>, <span class="st">"IPM AND IDM"</span>,</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FERTILIZER</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTILIZER"</span>, <span class="st">"FERTILIZING"</span>, <span class="st">"FERTIGATION"</span>, <span class="st">"FYM"</span>, <span class="st">"COMPOST"</span>, <span class="st">"NUTRIENT"</span>, <span class="st">"HORMONE"</span>, <span class="st">"SULPHUR"</span>, <span class="st">"VITAMIN"</span>)</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>pattern_oper <span class="ot">&lt;-</span> <span class="fu">paste</span>(key_operations, <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>CultInput <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OPERATION =</span> <span class="fu">if_else</span>(</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(<span class="fu">str_to_upper</span>(OPERATION), pattern_oper),</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_extract</span>(<span class="fu">str_to_upper</span>(OPERATION), pattern_oper),</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    OPERATION</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>2. Regrouper les opérations</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regrouper les opérations en principales opérations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>correspondances_oper <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>OPERATION_VARIANT,                             <span class="sc">~</span>OPERATION_STANDARD,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># LAND PREPARATION</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LAND PREPARATION"</span>,                             <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD PREPARATION"</span>,                            <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BEEDING"</span>,                                      <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BED PREPARATION"</span>,                              <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BED PREPRATION"</span>,                               <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PREPARATION OF BED"</span>,                           <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FURROW"</span>,                                       <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EARTHING UP"</span>,                                  <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOIL UP"</span>,                                      <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOIL SPREADING"</span>,                               <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLOUGHING"</span>,                                    <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUDDLING"</span>,                                     <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLUGHING"</span>,                                     <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PANJI"</span>,                                        <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PUNJI"</span>,                                        <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARROWING"</span>,                                    <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BROAD CASTING"</span>,                                <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PHANTAN"</span>,                                      <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"V-PASS"</span>,                                       <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MAKING RIDGES &amp; FURROWS"</span>,                      <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROTAVATOR"</span>,                                    <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CANAL PREPARATION"</span>,                            <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># LEVELING</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEVELING"</span>,                                     <span class="st">"LEVELING"</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEVELLING"</span>,                                    <span class="st">"LEVELING"</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># BUNDING</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BUND"</span>,                                         <span class="st">"BUNDING"</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WATER CHANNEL"</span>,                                <span class="st">"BUNDING"</span>,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WATERING"</span>,                                     <span class="st">"BUNDING"</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BASIN"</span>,                                        <span class="st">"BUNDING"</span>,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DIGGING</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIGGING"</span>,                                      <span class="st">"DIGGING"</span>,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FILLING"</span>,                                      <span class="st">"DIGGING"</span>,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LINES"</span>,                                        <span class="st">"DIGGING"</span>,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LINING"</span>,                                       <span class="st">"DIGGING"</span>,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LINE MAKING"</span>,                                  <span class="st">"DIGGING"</span>,</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PITTING"</span>,                                      <span class="st">"DIGGING"</span>,</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRENCHING"</span>,                                    <span class="st">"DIGGING"</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># INTERCULTURE</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INTERCULTURE"</span>,                                 <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HOEING"</span>,                                       <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLUCKING"</span>,                                     <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THINNING"</span>,                                     <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BEDICIDE"</span>,                                     <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BINDING"</span>,                                      <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FENCING"</span>,                                      <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FENCE"</span>,                                        <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GRIDLING"</span>,                                     <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GIRDLING"</span>,                                     <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MANURING</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANURING"</span>,                                     <span class="st">"MANURING"</span>,</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MULCHING"</span>,                                     <span class="st">"MANURING"</span>,</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PINCHING/CUTTING</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PRUNING"</span>,                                      <span class="st">"PINCHING/CUTTING"</span>,</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PINCHING"</span>,                                     <span class="st">"PINCHING/CUTTING"</span>,</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CUTTING"</span>,                                      <span class="st">"PINCHING/CUTTING"</span>,</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NIPPING"</span>,                                      <span class="st">"PINCHING/CUTTING"</span>,</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AIR LAYERING"</span>,                                 <span class="st">"PINCHING/CUTTING"</span>,</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># UPROOTING</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UPROOTING"</span>,                                    <span class="st">"UPROOTING"</span>,</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIELD CLEANING</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GRASS CLEANING"</span>,                               <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD CLEANING"</span>,                               <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SIDE CLEANING"</span>,                                <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CLEANING WEED"</span>,                                <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CLEANING AND WEEDING"</span>,                         <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEEDING AND CLEANING"</span>,                         <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CLEANING"</span>,                                     <span class="st">"FIELD CLEANING"</span>,</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRANSPLANTING</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPLANTING"</span>,                                <span class="st">"TRANSPLANTING"</span>,</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLANTING"</span>,                                     <span class="st">"TRANSPLANTING"</span>,</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLANTATION"</span>,                                   <span class="st">"TRANSPLANTING"</span>,</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SOWING</span></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOWING"</span>,                                       <span class="st">"SOWING"</span>,</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEED"</span>,                                         <span class="st">"SOWING"</span>,</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DRENCHING"</span>,                                    <span class="st">"SOWING"</span>,</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIPPING"</span>,                                      <span class="st">"SOWING"</span>,</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PLANT PROTECTION</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLANT PROTECTION"</span>,                             <span class="st">"PLANT PROTECTION"</span>,</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BAGGING"</span>,                                      <span class="st">"PLANT PROTECTION"</span>,</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ASH"</span>,                                          <span class="st">"PLANT PROTECTION"</span>,</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PESTICIDE</span></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FUMIGATION"</span>,                                   <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SPRAY"</span>,                                        <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FUNGICIDE"</span>,                                    <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INSECTICIDE"</span>,                                  <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DEFOLIATION"</span>,                                  <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IPM AND IDM"</span>,                                  <span class="st">"PESTICIDE"</span>,</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HERBICIDE</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HERBICIDE"</span>,                                    <span class="st">"HERBICIDE"</span>,</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEEDICIDE"</span>,                                    <span class="st">"HERBICIDE"</span>,</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARBISIDE"</span>,                                    <span class="st">"HERBICIDE"</span>,</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARBICIDE"</span>,                                    <span class="st">"HERBICIDE"</span>,</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FERTILIZER</span></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTILIZER"</span>,                                   <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTIGATION"</span>,                                  <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTILIZING"</span>,                                  <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FYM"</span>,                                          <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMPOST"</span>,                                      <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NUTRIENT"</span>,                                     <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TILIZER APPLICATION"</span>,                          <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HORMONE"</span>,                                      <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARMONE APPLICATION"</span>,                          <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SULPHUR"</span>,                                      <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VITAMIN"</span>,                                      <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HARVESTINGTHRESHING</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARVEST"</span>,                                      <span class="st">"HARVESTING"</span>,</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># THRESHING</span></span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THRASHING"</span>,                                    <span class="st">"THRESHING"</span>,</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THRESHING"</span>,                                    <span class="st">"THRESHING"</span>,</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># WINNOWING</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WINNOWING"</span>,                                    <span class="st">"WINNOWING"</span>,</span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MARKETING</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MARKETING"</span>,                                    <span class="st">"MARKETING"</span>,</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MAKING BY PRODUCT"</span>,                            <span class="st">"MARKETING"</span>,</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LABELING"</span>,                                     <span class="st">"MARKETING"</span>,</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LABLING"</span>,                                      <span class="st">"MARKETING"</span>,</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ABELING"</span>,                                      <span class="st">"MARKETING"</span>,</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TAGGING"</span>,                                      <span class="st">"MARKETING"</span>,</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SUPERVISION</span></span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SUPERVISION"</span>,                                  <span class="st">"SUPERVISION"</span>,</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WATCHING"</span>,                                     <span class="st">"SUPERVISION"</span>,</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IRRIGATION</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IRRIGATION"</span>,                                   <span class="st">"IRRIGATION"</span>,</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PIPELINE"</span>,                                     <span class="st">"IRRIGATION"</span>,</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HAND WEEDING</span></span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HAND WEEDING"</span>,                                 <span class="st">"HAND WEEDING"</span>,</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEEDING"</span>,                                      <span class="st">"WEEDING"</span>,</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># NURSERY RAISING</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NURSERY RAISING"</span>,                              <span class="st">"NURSERY RAISING"</span>,</span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRANSPORT</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPORT"</span>,                                    <span class="st">"TRANSPORT"</span>,</span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LOADING"</span>,                                      <span class="st">"TRANSPORT"</span>,</span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CARRY"</span>,                                        <span class="st">"TRANSPORT"</span>,</span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>  <span class="st">"STACKING"</span>,                                     <span class="st">"TRANSPORT"</span>,</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PACKING"</span>,                                      <span class="st">"TRANSPORT"</span>,</span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OTHERS</span></span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OTHERS"</span>,                                       <span class="st">"OTHERS"</span>,</span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CURING"</span>,                                       <span class="st">"OTHERS"</span>,</span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COLLECTION"</span>,                                   <span class="st">"OTHERS"</span>,</span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSFORMATION"</span>,                               <span class="st">"OTHERS"</span>,</span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PROCESSING"</span>,                                   <span class="st">"OTHERS"</span>,</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REMOVING"</span>,                                     <span class="st">"OTHERS"</span>,</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GRADING"</span>,                                      <span class="st">"OTHERS"</span></span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CultInput : Appliquer les opérations harmonisées</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>CultInput <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correspondances_oper, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"OPERATION"</span> <span class="ot">=</span> <span class="st">"OPERATION_VARIANT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">OPERATION =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(OPERATION_STANDARD) <span class="sc">~</span> OPERATION_STANDARD,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"OTHERS"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>OPERATION_STANDARD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>3. Créer les catégories principales</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nouvelles catégories OPERATION</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cat_operations <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>SUB_OPERATION,        <span class="sc">~</span>OPERATION,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HAND WEEDING"</span>,        <span class="st">"WEEDING"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEEDING"</span>,             <span class="st">"WEEDING"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD CLEANING"</span>,      <span class="st">"WEEDING"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HERBICIDE"</span>,           <span class="st">"WEEDING"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARVESTING"</span>,          <span class="st">"HARVESTING &amp; THRESHING"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THRESHING"</span>,           <span class="st">"HARVESTING &amp; THRESHING"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WINNOWING"</span>,           <span class="st">"HARVESTING &amp; THRESHING"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INTERCULTURE"</span>,        <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PINCHING/CUTTING"</span>,    <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANURING"</span>,            <span class="st">"INTERCULTURE"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IRRIGATION"</span>,          <span class="st">"IRRIGATION"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LAND PREPARATION"</span>,    <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BUNDING"</span>,             <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIGGING"</span>,             <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEVELING"</span>,            <span class="st">"LAND PREPARATION"</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MARKETING"</span>,           <span class="st">"MARKETING"</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOWING"</span>,              <span class="st">"SEED SOWING"</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPLANTING"</span>,       <span class="st">"TRANSPLANTING"</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UPROOTING"</span>,           <span class="st">"TRANSPLANTING"</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PLANT PROTECTION"</span>,    <span class="st">"PLANT PROTECTION MEASURES"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PESTICIDE"</span>,           <span class="st">"PLANT PROTECTION MEASURES"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTILIZER APPL."</span>,    <span class="st">"FERTILIZER APPL."</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SUPERVISION"</span>,         <span class="st">"SUPERVISION"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRANSPORT"</span>,           <span class="st">"TRANSPORT"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NURSERY RAISING"</span>,     <span class="st">"NURSERY RAISING"</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OTHERS"</span>,              <span class="st">"OTHERS"</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter les opérations recatégorisées dans Cultivation_cult_distinctes</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>CultInput <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SUB_OPERATION =</span> OPERATION) <span class="sc">|&gt;</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cat_operations, <span class="at">by =</span> <span class="st">"SUB_OPERATION"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(OPERATION, <span class="at">.after =</span> DT_OPER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="gérer-les-doublons" class="level2">
<h2 class="anchored" data-anchor-id="gérer-les-doublons">Gérer les doublons</h2>
<section id="cultinput" class="level3">
<h3 class="anchored" data-anchor-id="cultinput">CultInput</h3>
<p><em>Lignes identiques dans CultInput</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dup_CultInput <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ATTENTION : Que faire des lignes identiques ? Est-ce qu’on considère que ce sont des lignes en double ou que cela représente des travailleurs distincts ?</p>
<p><em>Diviser CultInput en 2 parties</em></p>
<p>Pour éliminer les doublons pour le calcul des heures de travail, je différencie la base CultInput en deux parties en se basant sur le questionnaire : l’une sur le travail (human and bullock labor), la deuxième sur la mécanisation (Machinery inputs and machinery use).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>CultInput_MAT <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(LAB_TYPE, WORK_HR, WAGE)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(NAME_MAT) <span class="sc">&amp;</span> <span class="fu">is.na</span>(TYPE_MAT)) <span class="sc">&amp;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>           NAME_MAT <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(TYPE_MAT, NAME_MAT, UNIT_MAT, QTY_MAT, RATE_MAT, VAL_MAT, SOURCE_MAT)) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(WORK_HR), <span class="sc">!</span><span class="fu">is.na</span>(LAB_TYPE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="labor" class="level4">
<h4 class="anchored" data-anchor-id="labor">Labor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondir WORK_HR à la première décimale (il y a des doublons créés à cause de cela)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>CultInput_LAB<span class="sc">$</span>WORK_HR <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(CultInput_LAB<span class="sc">$</span>WORK_HR))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>CultInput_LAB<span class="sc">$</span>WORK_HR <span class="ot">&lt;-</span> <span class="fu">round</span>(CultInput_LAB<span class="sc">$</span>WORK_HR, <span class="dv">1</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>CultInput_LAB<span class="sc">$</span>WAGE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(CultInput_LAB<span class="sc">$</span>WAGE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Gérer les doublons</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionner les lignes identiques</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput_LAB)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">WORK_HR =</span> <span class="fu">sum</span>(WORK_HR),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">WAGE =</span> <span class="fu">sum</span>(WAGE),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(CultInput_LAB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 517</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les doublons lorsque seule la date SUR_MON_YR diffère (en conservant la date la plus ancienne)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput_LAB)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(SUR_MON_YR) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="sc">-</span>SUR_MON_YR), <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(CultInput_LAB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p>Je vérifie si les doublons de WORK_HR dans CultInput_LAB sont dûs à des salaires différents et pourraient donc représenter des travailleurs distincts. On identifie les doublons pour lesquels les différences entre temps de travail et salaire sont cohérentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau des doublons par rapport à WORK_HR et WAGE</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>dup_CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(WAGE, WORK_HR))) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(WAGE)) <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer la variable comparison pour vérifier la cohérence de WORK_HR et WAGE entre chaque doublon</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">WAGE =</span> <span class="fu">as.numeric</span>(WAGE),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">WORK_HR =</span> <span class="fu">as.numeric</span>(WORK_HR)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> row_id,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(WAGE, WORK_HR),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_row{row_id}"</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_diff =</span> WAGE_row1 <span class="sc">-</span> WAGE_row2,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">work_hr_diff =</span> WORK_HR_row1 <span class="sc">-</span> WORK_HR_row2,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">comparison =</span> <span class="fu">sign</span>(wage_diff) <span class="sc">==</span> <span class="fu">sign</span>(work_hr_diff) <span class="sc">&amp;</span> wage_diff <span class="sc">!=</span> <span class="dv">0</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de doublons avec un salaire et un temps de travail cohérents :"</span>, <span class="fu">nrow</span>(dup_CultInput_LAB <span class="sc">|&gt;</span> <span class="fu">filter</span>(comparison)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de doublons avec un salaire et un temps de travail cohérents : 786 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sur un total de"</span>, <span class="fu">nrow</span>(dup_CultInput_LAB), <span class="st">"doublons soit"</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">nrow</span>(dup_CultInput_LAB <span class="sc">|&gt;</span> <span class="fu">filter</span>(comparison)) <span class="sc">/</span> <span class="fu">nrow</span>(dup_CultInput_LAB), <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sur un total de 890 doublons soit 88.3 %</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les doublons entre WAGE et WORK_HR quand les salaires et les heures de travail ne sont pas cohérents (en conservant le nombre le plus haut)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dup_CultInput_LAB <span class="ot">&lt;-</span> dup_CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_NAME, SUB_PLOT_CODE, CROP_AREA, IRRI_AREA, SEASON, SUR_MON_YR, DT_OPER, OPERATION, LAB_TYPE, comparison)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput_LAB)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dup_CultInput_LAB, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_NAME"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"CROP_AREA"</span>, <span class="st">"IRRI_AREA"</span>, <span class="st">"SEASON"</span>, <span class="st">"SUR_MON_YR"</span>, <span class="st">"DT_OPER"</span>, <span class="st">"OPERATION"</span>, <span class="st">"LAB_TYPE"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(WORK_HR, WAGE, comparison))) <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(comparison) <span class="sc">|</span> comparison <span class="sc">|</span> WAGE <span class="sc">==</span> <span class="fu">max</span>(WAGE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comparison) <span class="sc">|&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(CultInput_LAB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 82</code></pre>
</div>
</div>
<p><em>Additionner les heures de travail par opération et type de travail</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput_LAB)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SUB_OPERATION) <span class="sc">|&gt;</span>           <span class="co"># SUB_OPERATION bloque le pivot wider</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(WAGE, WORK_HR))) <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">WORK_HR =</span> <span class="fu">sum</span>(WORK_HR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">WAGE =</span> <span class="fu">sum</span>(WAGE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HACRE =</span> WORK_HR <span class="sc">/</span> CROP_AREA)   <span class="co"># Calculer les heures de travail par acre</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(CultInput_LAB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1072</code></pre>
</div>
</div>
<p><em>Pivoter la table CultInput_LAB</em></p>
<p>L’objectif est d’avoir pour chaque opération (même date d’opération), une seule ligne par champ indiquant les heures de travail par type de travail. Pour ce faire, je pivote en large la table CultInput_LAB.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>CultInput_LAB <span class="ot">&lt;-</span> CultInput_LAB <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> LAB_TYPE,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(WORK_HR, WAGE, HACRE),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">WORK_HR =</span> <span class="dv">0</span>, <span class="at">WAGE =</span> <span class="cn">NA_real_</span>, <span class="at">HACRE =</span> <span class="dv">0</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_{LAB_TYPE}"</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="machinery" class="level4">
<h4 class="anchored" data-anchor-id="machinery">Machinery</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Est-ce que des ménages ont utilisé plusieurs outils pour une même opération (même date d'opération) ? </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dup_CultInput_MAT <span class="ot">&lt;-</span> CultInput_MAT <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, PLOT_CODE, SUB_PLOT_CODE, SEASON, OPERATION, DT_OPER, SUR_MON_YR) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>1. Catégoriser TYPE_MAT</em></p>
<p>Je modifie TYPE_MAT quand l’information est manquante, en fonction de NAME_MAT (je ne peux pas me baser sur l’opération, car pour un même type d’opération, il peut avoir plusieurs outils utilisés).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table de correspondance entre NAME_MAT et TYPE_MAT</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>correspondances_typemat <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>NAME_MAT,             <span class="sc">~</span>TYPE_MAT,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FERTILIZER"</span>,          <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UREA"</span>,                <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"URE"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"URIA"</span>,                <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SPP"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MOP"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NPK"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"N.P.K"</span>,               <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SULPHATE"</span>,            <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AMMONIUM SULPHATE"</span>,   <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POUSHAK"</span>,             <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DAP"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POTASH"</span>,              <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POTAS"</span>,               <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PATAS"</span>,               <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UREA, AMMONIUM"</span>,      <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UREA, POTASH"</span>,        <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UREA GOMOR"</span>,          <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GROWMORE"</span>,            <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SSP"</span>,                 <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GROMOR"</span>,              <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"19-19-19"</span>,            <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BIPUL VITAMIN"</span>,       <span class="st">"FERTILIZER"</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEEDICIDE"</span>,           <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PRITI HARBICIDE"</span>,     <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IMAZETHAPYR 10% SL"</span>,  <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROUNDUP"</span>,             <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MASCHETI"</span>,            <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PURSUIT"</span>,             <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-4D"</span>,                <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"24D"</span>,                 <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HEERA SUPER"</span>,         <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PHOSPHATE"</span>,           <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IMAZETHAPYR"</span>,         <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HUNTER"</span>,              <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TOTAL"</span>,               <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BUTACLOUR"</span>,           <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-4D"</span>,                <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2, 4D"</span>,               <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SATHI"</span>,               <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SAATHI"</span>,              <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TOP STAR"</span>,            <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BUTOCLOX"</span>,            <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GOL"</span>,                 <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ALLGRIP"</span>,             <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TARGA SUPER"</span>,         <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LAGAAM"</span>,              <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PETICLOUR"</span>,           <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"REJAR"</span>,               <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DANADAR"</span>,             <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROGOHTI"</span>,             <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NOMNI GOLD"</span>,          <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ANUGOR"</span>,              <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JUDO"</span>,                <span class="st">"WEEDICIDE"</span>,</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MACHINERY"</span>,           <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TR"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T.R"</span>,                 <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRACTOR"</span>,             <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SP"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SPRAYER"</span>,             <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SPRAY"</span>,               <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DS"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DUSTER"</span>,              <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SM"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SUBMERSIBLE PUMP"</span>,    <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PT"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POWER TILLER"</span>,        <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CH"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"C.H"</span>,                 <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMBINED HARVESTER"</span>,  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMBINED HARVESTOR"</span>,  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HARVESTER"</span>,           <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SD"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEED DRILL"</span>,          <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MK"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DP"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"D.P"</span>,                 <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DIESEL PUMP"</span>,         <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KEROSENE PUMP"</span>,       <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TH"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THRESHER"</span>,            <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ET"</span>,                  <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"E.T"</span>,                 <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ELECTRIC MOTOR"</span>,      <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AUTO"</span>,                <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRUCK"</span>,               <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WINNOWER"</span>,            <span class="st">"MACHINERY"</span>,</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEE"</span>,                 <span class="st">"SEED"</span>,</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ONION"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ONIONS"</span>,              <span class="st">"SEED"</span>,</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BEAN"</span>,                <span class="st">"SEED"</span>,</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BEANS"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHILLIES"</span>,            <span class="st">"SEED"</span>,</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN GRAM"</span>,          <span class="st">"SEED"</span>,</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREENGRAM"</span>,           <span class="st">"SEED"</span>,</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WHEAT"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WHEET"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JAI"</span>,                 <span class="st">"SEED"</span>,</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LENTIL"</span>,              <span class="st">"SEED"</span>,</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FINGER MILLET"</span>,       <span class="st">"SEED"</span>,</span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANSURI"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GANGOTRI"</span>,            <span class="st">"SEED"</span>,</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KOMAL"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RUPALI"</span>,              <span class="st">"SEED"</span>,</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PARVATI"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHANDAN"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DHAICHA"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AMAN"</span>,                <span class="st">"SEED"</span>,</span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PIGEONPEA"</span>,           <span class="st">"SEED"</span>,</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SOYBEAN"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHICKPEA"</span>,            <span class="st">"SEED"</span>,</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BLACKGRAM"</span>,           <span class="st">"SEED"</span>,</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SORGHUM"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POTATO"</span>,              <span class="st">"SEED"</span>,</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GARLIC"</span>,              <span class="st">"SEED"</span>,</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PEAS"</span>,                <span class="st">"SEED"</span>,</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MUSTARD"</span>,             <span class="st">"SEED"</span>,</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MAIZE"</span>,               <span class="st">"SEED"</span>,</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EGYPTYIN COLVER (BAESEEM)"</span>, <span class="st">"SEED"</span>,</span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PESTICIDE"</span>,           <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SUPER KILLER-10"</span>,     <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROGORUS"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TATAMEDA"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THIMET-10-G"</span>,         <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FUNGICIDE"</span>,           <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FUNGISIDE"</span>,           <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MEDICINE"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>  <span class="st">"INDOPHEN"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SP (SARK)"</span>,           <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SWARNA"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRIAZOPHOS"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROGAR"</span>,               <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PENDIMETHALIN"</span>,       <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PROCLAIM"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SHOOTER"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PROFIX SUPER"</span>,        <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IMIDACLOPRID"</span>,        <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ACEPHATE"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ANTRACOL"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MONOCROTOPHOS"</span>,       <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MONOCROTOPHOS 36% SL"</span>, <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DORMEX"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SULPHUR"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SONA POWDER"</span>,         <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CARBENDAIZM"</span>,         <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LANCER GOLD"</span>,         <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BIFENTHRIN"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TEBUCONAZOLE"</span>,        <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BOULD"</span>,               <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SAVILS"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FLONICAMID"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>  <span class="st">"QUINALPHOS"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SAAF"</span>,                <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FENPROPATHRIN"</span>,       <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ERADICATOR"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMBIPLUS"</span>,           <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PHORATE"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIPRONIL"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PHENTHOATE"</span>,          <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EMAMECTIN BENZOATE"</span>,  <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FANTAC PLUS"</span>,         <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CYPERMETHRIN"</span>,        <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CROJAINE"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a>  <span class="st">"METASINE"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHLORPYRIPHOS 50% EC"</span>, <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRICYCLAZOLE 75%"</span>,    <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHLORANTRANILPROLE"</span>,  <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LUCID"</span>,               <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRACER"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRICOFAL"</span>,            <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>  <span class="st">"THRISUL"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COROZEN"</span>,             <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PACTUS"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VAJRA"</span>,               <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VAJRAM"</span>,              <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POLO"</span>,                <span class="st">"PESTICIDE"</span>,</span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FYM"</span>,                 <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMPOST"</span>,             <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MANURE"</span>,              <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>  <span class="st">"POULTRY MANURE"</span>,      <span class="st">"ORGANIC MATERIAL"</span>, </span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VERMICOMPOST"</span>,        <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VERMI COMPOST"</span>,       <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEAFY VEGETABLE"</span>,     <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VEGETABLE"</span>,           <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GREEN LEAF"</span>,          <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ASH"</span>,                 <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COW DUNG"</span>,            <span class="st">"ORGANIC MATERIAL"</span>,</span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZINC"</span>,                <span class="st">"MICRONUTRIENT"</span>,</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>  <span class="st">"D LAB LAB"</span>,           <span class="st">"MICRONUTRIENT"</span>,</span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CALCIUM"</span>,             <span class="st">"MICRONUTRIENT"</span>,</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BHUCHETAN"</span>,           <span class="st">"MICRONUTRIENT"</span>,</span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TONIC"</span>,               <span class="st">"MICRONUTRIENT"</span></span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifier TYPE_MAT quant il est manquant selon le tableau de correspondance</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>type_mat_missing <span class="ot">&lt;-</span> CultInput_MAT <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(TYPE_MAT)) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TYPE_MAT) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(correspondances_typemat, <span class="at">by =</span> <span class="st">"NAME_MAT"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Règles supplémentaires : </span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Si NAME_MAT contient SEED ou PADDY, alors TYPE_MAT = "SEED"</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">TYPE_MAT =</span> <span class="fu">case_when</span>(</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(NAME_MAT, <span class="fu">regex</span>(<span class="st">"SEED|PADDY"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"SEED"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Tous les TYPE_MAT encore NA deviennent "OTHERS"</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(TYPE_MAT) <span class="sc">~</span> <span class="st">"OTHERS"</span>,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> TYPE_MAT</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les lignes modifiées dans la table d'origine</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>CultInput_MAT <span class="ot">&lt;-</span> CultInput_MAT <span class="sc">|&gt;</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(TYPE_MAT)) <span class="sc">|&gt;</span>    <span class="co"># Garder les lignes avec TYPE_MAT déjà rempli</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(type_mat_missing)    <span class="co"># Ajouter les lignes complétées depuis correspondances</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>2. Pivoter la table CultInput_MAT</em></p>
<p>L’objectif est d’avoir pour chaque opération (même date d’opération), une seule ligne par champ indiquant toutes les outils utilisés à cette date. Pour ce faire, je pivote en large la table CultInput_MAT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>CultInput_MAT <span class="ot">&lt;-</span> CultInput_MAT <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, SUB_PLOT_CODE, SEASON, DT_OPER, OPERATION, <span class="at">.keep =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(VDS_ID, PLOT_NAME, PLOT_CODE, SUB_PLOT_CODE, CROP_AREA, IRRI_AREA, SEASON, REGION, SUR_MON_YR, DT_OPER, OPERATION),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> row_id,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(TYPE_MAT, NAME_MAT, UNIT_MAT, QTY_MAT, VAL_MAT, RATE_MAT, SOURCE_MAT),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_{row_id}"</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fusionné" class="level4">
<h4 class="anchored" data-anchor-id="fusionné">Fusionné</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(CultInput_MAT[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_NAME"</span>, <span class="st">"PLOT_CODE"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"CROP_AREA"</span>, <span class="st">"SUR_MON_YR"</span>, <span class="st">"DT_OPER"</span>, <span class="st">"OPERATION"</span>, <span class="st">"SEASON"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(CultInput_LAB[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_NAME"</span>, <span class="st">"PLOT_CODE"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"CROP_AREA"</span>, <span class="st">"SUR_MON_YR"</span>, <span class="st">"DT_OPER"</span>, <span class="st">"OPERATION"</span>, <span class="st">"SEASON"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>keys_join <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_NAME"</span>, <span class="st">"PLOT_CODE"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"REGION"</span>, <span class="st">"CROP_AREA"</span>, <span class="st">"IRRI_AREA"</span>, <span class="st">"SUR_MON_YR"</span>, <span class="st">"DT_OPER"</span>, <span class="st">"OPERATION"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fusionner les deux tables</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>CultInput_merged <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  CultInput_LAB,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  CultInput_MAT,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> keys_join</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plotlist" class="level3">
<h3 class="anchored" data-anchor-id="plotlist">PlotList</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes identiques</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(PlotList)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span> <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les doublons causés par des valeurs de IRRI_AREA différentes</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(IRRI_AREA) <span class="sc">|&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">across</span>(<span class="sc">-</span>IRRI_AREA), <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(PlotList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<p><em>Corriger les superficies manquantes</em></p>
<p>Lorsque la superficie du subplot est manquante et que Plot_code est égale au Sub_plot_code, je considère la superficie du plot si elle est indiquée.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>na_crop_area <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(VDS_ID, PLOT_CODE, SUB_PLOT_CODE, PLOT_AREA, CROP_AREA, SEASON) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(CROP_AREA))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de champs sans Crop_area : "</span>, <span class="fu">nrow</span>(na_crop_area), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de champs sans Crop_area :  37 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CROP_AREA =</span> <span class="fu">if_else</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(CROP_AREA) <span class="sc">&amp;</span> PLOT_CODE <span class="sc">==</span> SUB_PLOT_CODE,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    PLOT_AREA,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    CROP_AREA</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Je supprime les champs pour lesquels aucune des informations principales n’est complétées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(PlotList)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_all</span>(<span class="fu">c</span>(CROP_AREA, PLOT_AREA, PLOT_CODE, SUB_PLOT_CODE), is.na))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(PlotList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p><em>Incohérences entre PLOT_CODE et SUB_PLOT_CODE</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lorsque SUB_PLOT_CODE n'est pas indiqué, je considère l'identifiant du plot (PLOT_CODE)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUB_PLOT_CODE =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(SUB_PLOT_CODE), PLOT_CODE, SUB_PLOT_CODE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Je modifie l’identifiant SUB_PLOT_CODE pour les champs dont les premières lettres de SUB_PLOT_CODE et PLOT_CODE sont incohérentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>diff_plot_code <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">substr</span>(SUB_PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">!=</span> <span class="fu">substr</span>(PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Champs où les premières lettres de PLOT_CODE et SUB_PLOT_CODE ne correspondent pas :"</span>, <span class="fu">nrow</span>(diff_plot_code), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Champs où les premières lettres de PLOT_CODE et SUB_PLOT_CODE ne correspondent pas : 2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifier SUB_PLOT_CODE pour ces champs</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">SUB_PLOT_CODE =</span> <span class="fu">if_else</span>(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">substr</span>(SUB_PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">!=</span> <span class="fu">substr</span>(PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_c</span>(<span class="fu">substr</span>(PLOT_CODE, <span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">str_sub</span>(SUB_PLOT_CODE, <span class="dv">2</span>)),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      SUB_PLOT_CODE</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Supprimer les doublons</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau des doublons PlotList</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dup_rows_PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, SUB_PLOT_CODE, SEASON) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes avec les mêmes variables VDS_ID / PLOT_CODE / SEASON en double. Supprimer celles avec le plus de NA.</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(PlotList)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_na =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), is.na))) <span class="sc">|&gt;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, PLOT_CODE, SUB_PLOT_CODE, PLOT_AREA, SEASON) <span class="sc">|&gt;</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> n_na, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_na)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(PlotList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
</section>
<section id="cultoutput" class="level3">
<h3 class="anchored" data-anchor-id="cultoutput">CultOutput</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes identiques</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span> <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivoter les variables CROP, PRCT_AREA, VAR_NAME, VAR_TYPE, OP_MAIN_PROD_UNIT et OP_MAIN_PROD_QTY en colonnes</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, PLOT_NAME, SUB_PLOT_CODE, SEASON, CROP_AREA, OW_STAT, RENT_FOR) <span class="sc">|&gt;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crop_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crop_id <span class="sc">&lt;=</span> <span class="dv">4</span>) <span class="sc">|&gt;</span>  <span class="co"># Limiter à 4 cultures max</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(VDS_ID, SUB_PLOT_CODE, PLOT_NAME, CROP_AREA, IRRI_AREA, SEASON, RENT_FOR, OW_STAT),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> crop_id,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(CROP, PRCT_AREA, VAR_NAME, VAR_TYPE, OP_MAIN_PROD_UNIT, OP_MAIN_PROD_QTY),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{.value}_{crop_id}"</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau des doublons CultOutput</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>dup_rows_CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, SUB_PLOT_CODE, SEASON) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes avec les mêmes variables VDS_ID / SUB_PLOT_CODE / SEASON en double. Supprimer celles avec le plus de NA.</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultOutput)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_na =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), is.na))) <span class="sc">|&gt;</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, SUB_PLOT_CODE, SEASON) <span class="sc">|&gt;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> n_na, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_na)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(CultOutput)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="landholding" class="level3">
<h3 class="anchored" data-anchor-id="landholding">Landholding</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau des doublons Landholding</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>dup_rows_Landholding <span class="ot">&lt;-</span> Landholding <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les doublons avec le même couple VDS_ID / PLOT_CODE. Supprimer les lignes avec le plus de n/a. </span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>n_avant <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Landholding)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>Landholding <span class="ot">&lt;-</span> Landholding <span class="sc">|&gt;</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_na =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), is.na))) <span class="sc">|&gt;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(VDS_ID, PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> n_na, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_na)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>n_avant <span class="sc">-</span> <span class="fu">nrow</span>(Landholding)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
</section>
</section>
<section id="vérifier-les-doublons-restants" class="level2">
<h2 class="anchored" data-anchor-id="vérifier-les-doublons-restants">Vérifier les doublons restants</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(PlotList[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"CROP_1"</span>, <span class="st">"CROP_2"</span>, <span class="st">"SEASON"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(CultOutput[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(CultInput_merged[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>, <span class="st">"OPERATION"</span>, <span class="st">"DT_OPER"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(Landholding[, <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_CODE"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Les doublons dans CultInput_merged sont causés par des incohérences entre SUR_MON_YR et DT_OPER.</p>
<hr>
</section>
</section>
<section id="création-dune-clé-de-jonction" class="level1">
<h1>Création d’une clé de jonction</h1>
<section id="correspondance-des-champs-entre-les-tables" class="level2">
<h2 class="anchored" data-anchor-id="correspondance-des-champs-entre-les-tables">Correspondance des champs entre les tables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier les couples (VDS_ID, PLOT_CODE)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>landholding_keys <span class="ot">&lt;-</span> Landholding <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_CODE)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>cultinput_plots_keys <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifier les lignes dans CultiInput qui n'ont pas de match dans Landholding</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>non_match3 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cultinput_plots_keys, landholding_keys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_CODE"</span>))</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>n_non_matched3 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(non_match3)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>n_total3 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cultinput_plots_keys)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>prop_non_matched3 <span class="ot">&lt;-</span> <span class="fu">round</span>(n_non_matched3 <span class="sc">/</span> n_total3 <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Total de plots dans CultInput :"</span>, n_total3, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Total de plots dans CultInput : 2795 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Plots sans match avec Landholding :"</span>, n_non_matched3, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Plots sans match avec Landholding : 108 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Proportion sans match :"</span>, prop_non_matched3, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Proportion sans match : 3.86 %</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier les couples (VDS_ID, SUB_PLOT_CODE, SEASON)</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>cultinput_keys <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>plotlist_keys <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifier les champs de CultInput non trouvés dans PlotList</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>non_match <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cultinput_keys, plotlist_keys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SEASON"</span>, <span class="st">"SUB_PLOT_CODE"</span>))</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>n_non_matched <span class="ot">&lt;-</span> <span class="fu">nrow</span>(non_match)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cultinput_keys)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>prop_non_matched <span class="ot">&lt;-</span> <span class="fu">round</span>(n_non_matched <span class="sc">/</span> n_total <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Plots totaux dans CultInput :"</span>, n_total, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Plots totaux dans CultInput : 4804 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Plots sans équivalent dans PlotList :"</span>, n_non_matched, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Plots sans équivalent dans PlotList : 81 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Proportion sans équivalent :"</span>, prop_non_matched, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Proportion sans équivalent : 1.69 %</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier les couples (VDS_ID, PLOT_CODE, SEASON)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>cultoutput_keys <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifier les champs de CultInput non trouvés dans CultOutput</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>non_match2 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cultinput_keys, cultoutput_keys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>))</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>n_non_matched2 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(non_match2)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>prop_non_matched2 <span class="ot">&lt;-</span> <span class="fu">round</span>(n_non_matched2 <span class="sc">/</span> n_total <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Plots totaux dans CultInput :"</span>, n_total, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Plots totaux dans CultInput : 4804 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Plots sans équivalent dans CultOutput :"</span>, n_non_matched2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Plots sans équivalent dans CultOutput : 6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Proportion sans équivalent :"</span>, prop_non_matched2, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Proportion sans équivalent : 0.12 %</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Faire ressortir les codes de chaque région puis comparer les bases</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>CultInput_merged <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">STATE =</span> <span class="fu">substr</span>(VDS_ID, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>PlotList  <span class="ot">&lt;-</span> PlotList  <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">STATE =</span> <span class="fu">substr</span>(VDS_ID, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">STATE =</span> <span class="fu">substr</span>(VDS_ID, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>Landholding <span class="ot">&lt;-</span> Landholding <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">STATE =</span> <span class="fu">substr</span>(VDS_ID, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>region_cultinput <span class="ot">&lt;-</span> <span class="fu">unique</span>(CultInput_merged<span class="sc">$</span>STATE)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>region_plotlist <span class="ot">&lt;-</span> <span class="fu">unique</span>(PlotList<span class="sc">$</span>STATE)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>region_cultoutput <span class="ot">&lt;-</span> <span class="fu">unique</span>(CultOutput<span class="sc">$</span>STATE)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>region_landholding <span class="ot">&lt;-</span> <span class="fu">unique</span>(Landholding<span class="sc">$</span>STATE)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">CultInput =</span> <span class="fu">sort</span>(region_cultinput),</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">PlotList =</span> <span class="fu">sort</span>(region_plotlist),</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">CultOutput =</span> <span class="fu">sort</span>(region_cultoutput),</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Landholding =</span> <span class="fu">sort</span>(region_landholding)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$CultInput
[1] "AP" "BH" "GJ" "JH" "KN" "MH" "MP" "OR"

$PlotList
[1] "AP" "BH" "GJ" "JH" "KN" "MH" "MP" "OR"

$CultOutput
[1] "AP" "BH" "GJ" "JH" "KN" "MH" "MP" "OR"

$Landholding
[1] "AP" "BH" "GJ" "JH" "KN" "MH" "MP" "OR"</code></pre>
</div>
</div>
</section>
<section id="base-validation_id" class="level2">
<h2 class="anchored" data-anchor-id="base-validation_id">Base validation_ID</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>validation_ID <span class="ot">&lt;-</span> cultinput_keys <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CROP_AREA_CI =</span> CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    plotlist_keys <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">CROP_AREA_PL =</span> CROP_AREA),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    cultoutput_keys <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">CROP_AREA_CO =</span> CROP_AREA), </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modifier-base-validation_id" class="level2">
<h2 class="anchored" data-anchor-id="modifier-base-validation_id">Modifier Base validation_ID</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Harmoniser la base validation_ID: quand 2 des 3 sources (_CI, _CO, _PL) sont identiques pour une même variable, remplacer la 3e valeur par cette valeur majoritaire.</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>harmonise_ID <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  var_CI <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="fu">paste0</span>(var, <span class="st">"_CI"</span>))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  var_CO <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="fu">paste0</span>(var, <span class="st">"_CO"</span>))</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  var_PL <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="fu">paste0</span>(var, <span class="st">"_PL"</span>))</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"{var}_CI"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(<span class="sc">!!</span>var_CI),</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"{var}_CO"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(<span class="sc">!!</span>var_CO),</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"{var}_PL"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(<span class="sc">!!</span>var_PL)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">var_CI :=</span> <span class="fu">case_when</span>(</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_CO) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_PL) <span class="sc">&amp;</span> <span class="sc">!!</span>var_CO <span class="sc">==</span> <span class="sc">!!</span>var_PL <span class="sc">~</span> <span class="sc">!!</span>var_CO,</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="sc">!!</span>var_CI</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">var_CO :=</span> <span class="fu">case_when</span>(</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_CI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_PL) <span class="sc">&amp;</span> <span class="sc">!!</span>var_CI <span class="sc">==</span> <span class="sc">!!</span>var_PL <span class="sc">~</span> <span class="sc">!!</span>var_CI,</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="sc">!!</span>var_CO</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">var_PL :=</span> <span class="fu">case_when</span>(</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_CI) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>var_CO) <span class="sc">&amp;</span> <span class="sc">!!</span>var_CI <span class="sc">==</span> <span class="sc">!!</span>var_CO <span class="sc">~</span> <span class="sc">!!</span>var_CI,</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="sc">!!</span>var_PL</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>validation_ID <span class="ot">&lt;-</span> <span class="fu">harmonise_ID</span>(validation_ID, <span class="st">"CROP_AREA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>validation_ID <span class="ot">&lt;-</span> validation_ID <span class="sc">|&gt;</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CROP_AREA_match =</span> CROP_AREA_CI <span class="sc">==</span> CROP_AREA_PL <span class="sc">&amp;</span> CROP_AREA_CI <span class="sc">==</span> CROP_AREA_CO)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>validation_ID_false <span class="ot">&lt;-</span> validation_ID <span class="sc">|&gt;</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>CROP_AREA_match)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>n_validation_ID <span class="ot">&lt;-</span> <span class="fu">nrow</span>(validation_ID)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>area_match <span class="ot">&lt;-</span> <span class="fu">nrow</span>(validation_ID <span class="sc">|&gt;</span> <span class="fu">filter</span>(CROP_AREA_match))</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>one_false <span class="ot">&lt;-</span> <span class="fu">nrow</span>(validation_ID <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span>CROP_AREA_match))</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total des champs identifiés dans CultInput :"</span>, n_validation_ID, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total des champs identifiés dans CultInput : 4804 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Area match :"</span>, area_match, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Area match : 4799 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Area false :"</span>, one_false, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Area false : 0 </code></pre>
</div>
</div>
</section>
<section id="identifier-les-champs-validés" class="level2">
<h2 class="anchored" data-anchor-id="identifier-les-champs-validés">Identifier les champs validés</h2>
<p>Je crée la variable OK pour identifier et sélectionner seulement les champs ayant leur équivalent dans les trois tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la variable OK</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>validation_ID <span class="ot">&lt;-</span> validation_ID <span class="sc">|&gt;</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OK =</span> <span class="fu">coalesce</span>(CROP_AREA_match, <span class="cn">FALSE</span>))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>nb_OK <span class="ot">&lt;-</span> <span class="fu">sum</span>(validation_ID<span class="sc">$</span>OK, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>nb_total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(validation_ID)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>pourcentage_OK <span class="ot">&lt;-</span> <span class="fu">round</span>((nb_OK <span class="sc">/</span> nb_total) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de lignes validées : "</span>, nb_OK, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de lignes validées :  4799 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pourcentage du total : "</span>, pourcentage_OK, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pourcentage du total :  99.9 %</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter la variable OK dans toutes les bases </span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># CultInput: </span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>CultInput_merged <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    validation_ID <span class="sc">|&gt;</span> <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, OK),</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(CultInput_merged, select(validation_ID, VDS_ID, SUB_PLOT_CODE, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1223 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CultOutput</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    validation_ID <span class="sc">|&gt;</span> <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, OK),</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co"># PlotList</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    validation_ID <span class="sc">|&gt;</span> <span class="fu">select</span>(VDS_ID, SUB_PLOT_CODE, SEASON, OK), </span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>nb_cultinput_OK <span class="ot">&lt;-</span> <span class="fu">sum</span>(CultInput_merged<span class="sc">$</span>OK, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>nb_cultinput_total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultInput_merged)</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>pourcentage_cultinput_OK <span class="ot">&lt;-</span> <span class="fu">round</span>((nb_cultinput_OK <span class="sc">/</span> nb_cultinput_total) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>nb_cultoutput_OK <span class="ot">&lt;-</span> <span class="fu">sum</span>(CultOutput<span class="sc">$</span>OK, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>nb_cultoutput_total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(CultOutput)</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>pourcentage_cultoutput_OK <span class="ot">&lt;-</span> <span class="fu">round</span>((nb_cultoutput_OK <span class="sc">/</span> nb_cultoutput_total) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>nb_plotlist_OK <span class="ot">&lt;-</span> <span class="fu">sum</span>(PlotList<span class="sc">$</span>OK, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>nb_plotlist_total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(PlotList)</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>pourcentage_plotlist_OK <span class="ot">&lt;-</span> <span class="fu">round</span>((nb_plotlist_OK <span class="sc">/</span> nb_plotlist_total) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>lignes_validees <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Base =</span> <span class="fu">c</span>(<span class="st">"CultInput"</span>, <span class="st">"CultOutput"</span>, <span class="st">"PlotList"</span>),</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Nombre de lignes validées</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(nb_cultinput_OK, nb_cultoutput_OK, nb_plotlist_OK),</span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total de lignes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(nb_cultinput_total, nb_cultoutput_total, nb_plotlist_total),</span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pourcentage validé (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(pourcentage_cultinput_OK, pourcentage_cultoutput_OK, pourcentage_plotlist_OK)</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lignes_validees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Base       Nombre de lignes validée…¹ `Total de lignes` Pourcentage validé (…²
  &lt;chr&gt;                           &lt;int&gt;             &lt;int&gt;                  &lt;dbl&gt;
1 CultInput                       56550             56598                   99.9
2 CultOutput                       4798              4897                   98  
3 PlotList                         4723              8006                   59  
# ℹ abbreviated names: ¹​`Nombre de lignes validées`, ²​`Pourcentage validé (%)`</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sélectionner dans toutes les bases seulement les lignes validées</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>CultInput_merged <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(OK<span class="sc">==</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>OK)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>CultOutput <span class="ot">&lt;-</span> CultOutput <span class="sc">|&gt;</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(OK<span class="sc">==</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>OK)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>PlotList <span class="ot">&lt;-</span> PlotList <span class="sc">|&gt;</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(OK<span class="sc">==</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="création-dune-base-commune" class="level1">
<h1>Création d’une base commune</h1>
<section id="joindre-en-colonne-les-bases" class="level2">
<h2 class="anchored" data-anchor-id="joindre-en-colonne-les-bases">Joindre en colonne les bases</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>Cultivation_wide <span class="ot">&lt;-</span> CultInput_merged <span class="sc">|&gt;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PLOT_NAME) <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co"># D'abord joindre avec CultOutput</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    CultOutput <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(PLOT_NAME, IRRI_AREA, STATE, CROP_AREA)),</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Puis joindre avec Landholding </span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Landholding <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>STATE), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"PLOT_CODE"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Enfin joindre avec PlotList</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    PlotList <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>      VDS_ID, PLOT_CODE, SUB_PLOT_CODE, PLOT_AREA, SEASON, </span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">IRRI_AREA_PL =</span> IRRI_AREA,</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">CROP_1_PL =</span> CROP_1,</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">CROP_2_PL =</span> CROP_2,</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">CROP_3_PL =</span> CROP_3,</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">CROP_4_PL =</span> CROP_4</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"VDS_ID"</span>, <span class="st">"SUB_PLOT_CODE"</span>, <span class="st">"SEASON"</span>)</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les NA avec les infos de PlotList</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">IRRI_AREA =</span> <span class="fu">coalesce</span>(IRRI_AREA, IRRI_AREA_PL),</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">CROP_1 =</span> <span class="fu">coalesce</span>(CROP_1, CROP_1_PL),</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">CROP_2 =</span> <span class="fu">coalesce</span>(CROP_2, CROP_2_PL),</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">CROP_3 =</span> <span class="fu">coalesce</span>(CROP_3, CROP_3_PL),</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">CROP_4 =</span> <span class="fu">coalesce</span>(CROP_4, CROP_4_PL)</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IRRI_AREA_PL, CROP_1_PL, CROP_2_PL, CROP_3_PL, CROP_4_PL))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(select(CultInput_merged, -PLOT_NAME), select(CultOutput, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1205 of `x` matches multiple rows in `y`.
ℹ Row 498 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(select(left_join(left_join(select(CultInput_merged, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1205 of `x` matches multiple rows in `y`.
ℹ Row 496 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Changer l'ordre des colonnes de Cultivation_wide</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>Cultivation_wide <span class="ot">&lt;-</span> Cultivation_wide <span class="sc">|&gt;</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(PLOT_CODE, <span class="at">.before =</span> SUB_PLOT_CODE) <span class="sc">|&gt;</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(PLOT_AREA, <span class="at">.before =</span> CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(SUR_MON_YR, <span class="at">.before =</span> VDS_ID) <span class="sc">|&gt;</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(IRRI_AREA, <span class="at">.after =</span> CROP_AREA) <span class="sc">|&gt;</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(VAR_TYPE_1, VAR_TYPE_2, VAR_TYPE_3, VAR_TYPE_4), </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">.after =</span> <span class="fu">c</span>(VAR_NAME_1, VAR_NAME_2, VAR_NAME_3, VAR_NAME_4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajouter-la-caste" class="level2">
<h2 class="anchored" data-anchor-id="ajouter-la-caste">Ajouter la caste</h2>
<p><em>Correspondance entre Cultivation_wide et Household_info</em></p>
<p>Les identifiants des ménages peuvent ne pas correspondre entre les deux tables, lorsque VDS_ID est indiqué pour la mauvaise année dans Household_info.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>dernier_chiffre <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">as.character</span>(annee), <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>Household_info <span class="ot">&lt;-</span> Household_info <span class="sc">|&gt;</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VDS_ID =</span> <span class="fu">ifelse</span>(<span class="fu">substr</span>(VDS_ID, <span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">!=</span> dernier_chiffre,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste0</span>(<span class="fu">substr</span>(VDS_ID, <span class="dv">1</span>, <span class="dv">4</span>), dernier_chiffre, <span class="fu">substr</span>(VDS_ID, <span class="dv">6</span>, <span class="fu">nchar</span>(VDS_ID))),</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>                         VDS_ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Je vérifie la correspondance des ménages entre Cultivation et Household_info, une fois les années harmonisées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>household_keys <span class="ot">&lt;-</span> Household_info <span class="sc">|&gt;</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID) <span class="sc">|&gt;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>cultivation_keys <span class="ot">&lt;-</span> Cultivation_wide <span class="sc">|&gt;</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VDS_ID) <span class="sc">|&gt;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifier les ménages de Cultivation_wide non trouvés dans Household_info</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>non_match4 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(cultivation_keys, household_keys, <span class="at">by =</span> <span class="st">"VDS_ID"</span>)</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>n_non_matched4 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(non_match4)</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>n_hh <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cultivation_keys)</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>prop_non_matched4 <span class="ot">&lt;-</span> <span class="fu">round</span>(n_non_matched4 <span class="sc">/</span> n_hh <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Ménages totaux dans Cultivation_wide :"</span>, n_hh, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Ménages totaux dans Cultivation_wide : 1026 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Ménages sans équivalent dans Household_info :"</span>, n_non_matched4, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Ménages sans équivalent dans Household_info : 0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" - Proportion sans équivalent :"</span>, prop_non_matched4, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> - Proportion sans équivalent : 0 %</code></pre>
</div>
</div>
<p><em>Ajouter la caste</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>Cultivation_wide <span class="ot">&lt;-</span> Cultivation_wide <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Household_info <span class="sc">|&gt;</span> <span class="fu">select</span>(VDS_ID, CASTE, CASTE_GROUP), <span class="at">by =</span> <span class="st">"VDS_ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CASTE_GROUP =</span> <span class="fu">recode</span>(CASTE_GROUP, <span class="st">`</span><span class="at">St</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ST"</span>, <span class="st">`</span><span class="at">Sc</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"SC"</span>, <span class="st">`</span><span class="at">Sbc</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">SBC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">Obc</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">Bc</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">Fc</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"FC"</span>, <span class="st">`</span><span class="at">OBC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">EBC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">SBC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">SBC/SEBC/EBC</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"BC"</span>, <span class="st">`</span><span class="at">Nt</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"OTHER"</span>, <span class="st">`</span><span class="at">NT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"OTHER"</span>, <span class="st">`</span><span class="at">Minorities</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"OTHER"</span>, <span class="st">`</span><span class="at">VJ</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"OTHER"</span>, <span class="st">`</span><span class="at">MINORITIES</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"OTHER"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Je regarde le nombre de n/a pour la caste dans Cultivation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>Cultivation_wide <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">na_caste =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(CASTE_GROUP)),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">n</span>(),</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_na =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> na_caste <span class="sc">/</span> total, <span class="dv">2</span>)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  na_caste total pct_na
     &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
1        0 56736      0</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="liens-extérieurs" class="level1">
<h1>Liens extérieurs</h1>
<section id="enregistrer-cultivation_wide_annee" class="level2">
<h2 class="anchored" data-anchor-id="enregistrer-cultivation_wide_annee">Enregistrer Cultivation_wide_annee</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le chemin du dossier</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>folder_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"Base de données générées"</span>, <span class="st">"Cultivation_wide"</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le dossier s'il n'existe pas</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(folder_path)) {</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(folder_path, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter l'année au nom de fichier</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>fichier_base <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Cultivation_wide_"</span>, annee)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Enregistrer le fichier CSV</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  Cultivation_wide,</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(folder_path, <span class="fu">paste0</span>(fichier_base, <span class="st">".csv"</span>)),</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Enregistrer le fichier RDS</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>  Cultivation_wide,</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(folder_path, <span class="fu">paste0</span>(fichier_base, <span class="st">".rds"</span>))</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>